---
import Layout from "../layouts/Layout.astro";
import { Projects } from "../data/Projects";
import { CvFr } from "../data/CvFr";
import { AnimatedTextComponent } from "../components/animation/AnimatedTextComponent";
import {WhitelistJoinComponent} from "../components/whitelist-join/whitelist-join";

const getValidUrl = (url: string) =>
    url.startsWith("http://") || url.startsWith("https://") ? url : `https://${url}`;
---

<Layout title={`Projets ${CvFr.person.fullName}`}>
  <div class="prose max-w-none">
    <h1 class="text-3xl font-bold mb-8">
      <AnimatedTextComponent text="Mes projets" timer={500} client:visible />
    </h1>

    <div class=" ">
      {
        Projects.map((project) => (

            <div class="card bg-base-200 group transition hover:-translate-y-1 hover:shadow-xl m-12">
              <figure class="relative  ">
                <a
                    href={getValidUrl(project.link)}
                    target="_blank"
                    rel="noopener noreferrer"
                    aria-label={`Ouvrir ${project.title}`}
                    class="absolute inset-0 z-10 block"
                />
                <img
                    src={typeof project.logo === 'string' ? project.logo : project.logo.src}
                    alt={project.title}
                    loading="lazy"
                    sizes="(max-width: 640px) 100vw, 33vw"
                />
              </figure>


              <div class="card-body">
                <h2 class="card-title text-xl">
                  <a href={getValidUrl(project.link)} target="_blank" rel="noopener noreferrer" class="hover:text-accent">
                    {project.title}
                  </a>
                </h2>

                <p class="mt-1">{project.resume}</p>

                <p class="text-sm mb-3">
                  <span class="italic">{project.description}</span>{project.time ? ` • ${project.time}` : ""}
                </p>

                <!-- Mode inscription whitelist -->
                <WhitelistJoinComponent
                    client:visible
                    title=`Intéressé par le projet  ${project.title} ?`
                    code=`${project.title}-interest`
                    plateforme=`${project.title} ?`
                    status="INITIATED"
                    description="Demande de whitelist via site"
                    enableMessage={true}
                />

                <p class="text-sm text-base-content/80">{project.abstract}</p>
                <div class="card-actions justify-end mt-4">
                  <a href={getValidUrl(project.link)} target="_blank" class="btn btn-sm btn-primary text-secondary-content">
                    Lien du projet
                  </a>
                </div>
              </div>
            </div>
        ))
      }
    </div>

    <div class="flex justify-center mt-8">
      <div class="join">
        <button class="join-item btn btn-sm">«</button>
        <button class="join-item btn btn-sm">1</button>
        <button class="join-item btn btn-sm btn-active">2</button>
        <button class="join-item btn btn-sm">3</button>
        <button class="join-item btn btn-sm">»</button>
      </div>
    </div>
  </div>
</Layout>
